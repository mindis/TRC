import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;

import TransactionManager.*;
import DataManager.*;
import Scheduler.*;

public class Main {
	public static String[] tables = null; 
	
	public static void main(String[] args) {
		System.out.println("*** PittHN starts executing ***");
		
		/*
		 * Getting input from user
		 */
		 System.out.println("Please input your program files, separated by comma (,): ");
		 String tmp = getInput();
		 TM.codes = tmp.split(",");
		
		 int flag;
		 do{
			 flag =1;
			 System.out.println("Please input the buffer size (in KB): ");
			 tmp = getInput();
		 try{
			 DM.bufferSize = Integer.parseInt(tmp);
		 }catch(Exception e){
			 flag = 0;
			 System.out.println("Invalid input.");
		 }
		 }while(flag==0);
		
		 System.out.println("Please input your tables' names, separated by space: ");
		 tmp = getInput();
		 tables = tmp.split(" ");
		 for(int i=0;i<tables.length;i++){
			 tables[i] = tables[i].trim();
		 }
		
		
		 do{
		 flag =1;
		 System.out.println("Please input the seed of the random number generator: ");
		 tmp = getInput();
		 try{
			 TM.randomSeed = Integer.parseInt(tmp);
		 }catch(Exception e){
			 flag = 0;
			 System.out.println("Invalid input.");
		 }
		 }while(flag==0);
		 
		 
		 
		 /*
		  * Initialization
		  */
		 for(int i=0;i<tables.length;i++){
			 L1_delta.tablePages.put(tables[i], new ArrayList());
			 L1_delta.tablePages.put(tables[i]+"<ID>", new ArrayList());
			 L1_delta.tablePages.put(tables[i]+"<ClientName>", new ArrayList());
			 L1_delta.tablePages.put(tables[i]+"<Phone>", new ArrayList());
		 }
		 
		 Utils.loadData();
		
		TM.execute();
		if(TM.instructionList.size()<1){
			System.out.println("No transactions received. ");
			System.out.println("*** PittHN finishes executing ***");
			System.exit(0);
		}
		
		//TODO Scheduler
		//Data passed from TM: TM.instructionList
		//Data passed to Data Manager:  DM.execute(ArrayList<instructions> inst)
		
		System.out.println("*** PittHN finishes executing ***");
		
	}
	
	
	public static String getInput(){
		String str="";
		 try {
	            InputStreamReader is_reader = new InputStreamReader(System.in);
	            str = new BufferedReader(is_reader).readLine();
	            
	        } catch (IOException e) {
	            e.printStackTrace();
	        }
		 return str.trim();
	}

}
